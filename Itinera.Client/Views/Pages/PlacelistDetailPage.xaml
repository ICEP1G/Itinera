<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Itinera.Client.Views.Pages.PlacelistDetailPage"
             xmlns:toolkit="clr-namespace:CommunityToolkit.Maui.Behaviors;assembly=CommunityToolkit.Maui"
             xmlns:components="clr-namespace:Itinera.Client.Views.Components"
             xmlns:errors="clr-namespace:Itinera.Client.Views.Errors"
             xmlns:converter="clr-namespace:Itinera.Client.Converters"
             Shell.NavBarIsVisible="False"
             Title="PlacelistDetailPage">

    <ContentPage.Resources>
        <converter:BoolAndBoolConverter x:Key="BoolAndBoolConverter" />
        <converter:BoolAndStringToBoolConverter x:Key="BoolAndStringToBoolConverter" />
        <converter:BoolToInvertBoolConverter x:Key="BoolToInvertBoolConverter" />
        <converter:StringNotNullToBoolConverter x:Key="StringNotNullToBoolConverter" />
        <converter:ValueNullToBoolConverter x:Key="ValueNullToBoolConverter" />
        <converter:ValueNullAndBoolFalseToBoolConverter x:Key="ValueNullAndBoolFalseToBoolConverter" />
    </ContentPage.Resources>

    <Grid ZIndex="1">
        <!--Loading-->
        <ActivityIndicator IsRunning="{Binding IsLoadingPlacelist}" VerticalOptions="Start" TranslationY="120" ZIndex="5"/>

        <!--Start Error container-->
        <VerticalStackLayout 
            Margin="16,0" 
            IsVisible="{Binding ErrorLoadingPlacelistContentPageData, Converter={StaticResource StringNotNullToBoolConverter}}"
            ZIndex="1">
            <!--Return button-->
            <Image Grid.Row="1" ZIndex="2" x:Name="ErrorReturnImage"
                    Source="backarrow_icon.png"
                    HeightRequest="18"
                    HorizontalOptions="Start"
                    VerticalOptions="Start"
                    Margin="0,16,0,32">
                <Image.Behaviors>
                    <toolkit:IconTintColorBehavior TintColor="{StaticResource PrimaryText}" />
                </Image.Behaviors>
                <Image.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding GoBackCommand}" />
                </Image.GestureRecognizers>
            </Image>
            <errors:ErrorSomethingWentWrong ErrorMessage="{Binding ErrorLoadingPlacelistContentPageData}" />
        </VerticalStackLayout>
        <!--End Error container-->

        <Grid ZIndex="1">
            <Grid.IsVisible>
                <MultiBinding Converter="{StaticResource ValueNullAndBoolFalseToBoolConverter}">
                    <Binding Path="ErrorLoadingPlacelistContentPageData" />
                    <Binding Path="IsLoadingPlacelist" />
                </MultiBinding>
            </Grid.IsVisible>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>
            <components:GeneralSearch Grid.Row="0" />

            <!--Placelist image-->
            <Grid Grid.Row="1" HeightRequest="200">
                <Image ZIndex="1"
                    Source="{Binding ImageUrl}"
                    Aspect="AspectFill"/>
            </Grid>

            <!--Return button-->
            <Image Grid.Row="1" ZIndex="2"
                Source="backarrow_icon.png"
                HeightRequest="18"
                HorizontalOptions="Start"
                VerticalOptions="Start"
                Margin="8,12,0,0">
                <Image.Behaviors>
                    <toolkit:IconTintColorBehavior TintColor="{StaticResource LightGrey}" />
                </Image.Behaviors>
                <Image.Shadow>
                    <Shadow Brush="Black" Offset="1,4" Radius="4" Opacity="0.3" />
                </Image.Shadow>
                <Image.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding GoBackCommand}" />
                </Image.GestureRecognizers>
            </Image>

            <!--Buttons-->
            <HorizontalStackLayout Grid.Row="1"
                    VerticalOptions="Start"
                    HorizontalOptions="End"
                    Margin="0,12,12,0"
                    Spacing="8">
                <!--Delete Placelist-->
                <Border Style="{StaticResource BorderMediumButtonFAB}"
                    IsVisible="{Binding IsItinerosOwnedPlacelist}"
                    BackgroundColor="{StaticResource Red}">
                    <Border.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding DeletePlacelistCommand}" />
                    </Border.GestureRecognizers>
                    <Image
                        Source="deleteplacelist_icon.png"
                        HeightRequest="28"
                        TranslationY="1">
                        <Image.Behaviors>
                            <toolkit:IconTintColorBehavior TintColor="{StaticResource White}" />
                        </Image.Behaviors>
                    </Image>
                </Border>
                <!--Recommand-->
                <HorizontalStackLayout IsVisible="{Binding IsItinerosOwnedPlacelist, Converter={StaticResource BoolToInvertBoolConverter}}">
                    <HorizontalStackLayout.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding UpdatePlacelistRecommandationCommand}" />
                    </HorizontalStackLayout.GestureRecognizers>
                    <components:ButtonChips BindingContext="{Binding ButtonChipsRecommendation}" />
                </HorizontalStackLayout>
                <!--Follow-->
                <HorizontalStackLayout IsVisible="{Binding IsItinerosOwnedPlacelist, Converter={StaticResource BoolToInvertBoolConverter}}">
                    <HorizontalStackLayout.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding UpdatePlacelistFollowCommand}" />
                    </HorizontalStackLayout.GestureRecognizers>
                    <components:ButtonChips BindingContext="{Binding ButtonChipsFollow}" />
                </HorizontalStackLayout>
            </HorizontalStackLayout>

            <!--Recommendation container-->
            <HorizontalStackLayout Grid.Row="1" ZIndex="2"
                VerticalOptions="End"
                Margin="8,0,0,60" 
                Spacing="12">
                <Image Source="star_icon.png"
                    IsVisible="{Binding IsFavorite}"
                    WidthRequest="30"
                    HeightRequest="30">
                    <Image.Shadow>
                        <Shadow Brush="Black" Offset="1,4" Radius="4" Opacity="0.5" />
                    </Image.Shadow>
                    <Image.Behaviors>
                        <toolkit:IconTintColorBehavior TintColor="{StaticResource Yellow}" />
                    </Image.Behaviors>
                </Image>
                <components:Recommendation RecommendationCount="{Binding RecommendationCount}" Size="Normal" DropShadow="True" />
            </HorizontalStackLayout>

            <!--Placelist title container-->
            <Grid Grid.Row="1" ZIndex="2"
                VerticalOptions="End"
                HeightRequest="48"
                Padding="8,2,16,2"
                ColumnSpacing="8"
                BackgroundColor="#CC615D60">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <Image Grid.Column="0"
                    Source="placelist_icon.png"
                    HeightRequest="32"
                    VerticalOptions="Center"/>
                <Label Grid.Column="1"
                    Text="{Binding Name}"
                    TextColor="{StaticResource White}"
                    FontSize="18"
                    FontFamily="PoppinsSemiBold"
                    LineBreakMode="TailTruncation"
                    VerticalTextAlignment="Center"/>
                <Image Grid.Column="2"
                    IsVisible="{Binding IsItinerosOwnedPlacelist}"
                    Source="edit_icon.png"
                    HeightRequest="24">
                    <Image.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding EditPlacelistCommand}" />
                    </Image.GestureRecognizers>
                </Image>
            </Grid>

            <!--Description container-->
            <Grid Grid.Row="2" ColumnSpacing="10" Padding="12">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <Border Grid.Column="0"
                HeightRequest="44"
                WidthRequest="44"
                VerticalOptions="Start"
                StrokeThickness="0"
                StrokeShape="RoundRectangle 22,0,22,22">
                    <Border.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding GoToOwnerItinerosPage}" />
                    </Border.GestureRecognizers>
                    <Image
                    Source="{Binding ItinerosOwnerPictureUrl}"
                    HeightRequest="44"
                    WidthRequest="44"
                    Aspect="AspectFill"/>
                </Border>
                <Border Grid.Column="1"
                StrokeThickness="0"
                StrokeShape="RoundRectangle 0,12,12,12"
                BackgroundColor="{StaticResource LightGrey}"
                Padding="12">
                    <Label
                    Text="{Binding Description}"
                    TextColor="{StaticResource PrimaryText}"
                    FontSize="12"
                    FontFamily="PoppinsMedium" />
                </Border>
            </Grid>

            <Grid Grid.Row="3">
                <!--Loading container-->
                <ActivityIndicator IsRunning="{Binding IsLoadingPlaceHeaders}" VerticalOptions="Start" TranslationY="50" />

                <!--Error container-->
                <VerticalStackLayout Grid.Row="3" Margin="16,0" IsVisible="{Binding ErrorLoadingPlaceHeadersData, Converter={StaticResource StringNotNullToBoolConverter}}">
                    <errors:ErrorSomethingWentWrong ErrorMessage="{Binding ErrorLoadingPlaceHeadersData}" />
                </VerticalStackLayout>

                <!--Places-->
                <CollectionView ItemsSource="{Binding Places}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <components:PlaceHeader BindingContext="{Binding}" />
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </Grid>

            <!--Add Place button-->
            <Border Grid.Row="3" Style="{StaticResource BorderLargeButtonFABPrimary}"
                Margin="0,0,24,24"
                VerticalOptions="End"
                HorizontalOptions="End">
                <Border.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding AddPlaceCommand}" />
                </Border.GestureRecognizers>
                <Image
                    Source="addplace_icon.png"
                    HeightRequest="32"
                    TranslationX="-1">
                    <Image.Behaviors>
                        <toolkit:IconTintColorBehavior TintColor="{StaticResource White}" />
                    </Image.Behaviors>
                </Image>
            </Border>
        </Grid>

    </Grid>
</ContentPage>