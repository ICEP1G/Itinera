<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Itinera.Client.Views.Pages.PlacelistsPage"
             xmlns:toolkit="clr-namespace:CommunityToolkit.Maui.Behaviors;assembly=CommunityToolkit.Maui"
             xmlns:components="clr-namespace:Itinera.Client.Views.Components"
             xmlns:converter="clr-namespace:Itinera.Client.Converters"
             Shell.NavBarIsVisible="False"
             Title="PlacelistsPage">

    <ContentPage.Resources>
        <converter:UsernameHashtagConverter  x:Key="UsernameHashtagConverter" />
        <converter:StringConcatConverter x:Key="StringConcatConverter" />
        <converter:BoolAndBoolConverter x:Key="BoolAndBoolConverter" />
    </ContentPage.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <components:GeneralSearch Grid.Row="0" />
        <components:TabMenu Grid.Row="1" BindingContext="{Binding TabMenu}" />

        <!--Placelists filters-->
        <HorizontalStackLayout Grid.Row="2" IsVisible="{Binding IsPlacelistsOwnedTabSelected}">
            <components:PlaceSearchFilters BindingContext="{Binding PlaceSearchFiltersOwnedPlacelists}"/>
        </HorizontalStackLayout>

        <HorizontalStackLayout Grid.Row="2" IsVisible="{Binding IsPlacelistsFollowedTabSelected}">
            <components:PlaceSearchFilters BindingContext="{Binding PlaceSearchFiltersFollowedPlacelists}"/>
        </HorizontalStackLayout>

        <!--Loading container-->
        <VerticalStackLayout Grid.Row="3"
            HorizontalOptions="Center">
            <ActivityIndicator IsRunning="{Binding IsLoadingOwnedPlacelists}" TranslationY="50">
                <ActivityIndicator.IsVisible>
                    <MultiBinding Converter="{StaticResource BoolAndBoolConverter}">
                        <Binding Path="IsPlacelistsOwnedTabSelected" />
                        <Binding Path="IsLoadingOwnedPlacelists" />
                    </MultiBinding>
                </ActivityIndicator.IsVisible>
            </ActivityIndicator>

            <ActivityIndicator IsRunning="{Binding IsLoadingFollowedPlacelists}" TranslationY="50">
                <ActivityIndicator.IsVisible>
                    <MultiBinding Converter="{StaticResource BoolAndBoolConverter}">
                        <Binding Path="IsPlacelistsFollowedTabSelected" />
                        <Binding Path="IsLoadingFollowedPlacelists" />
                    </MultiBinding>
                </ActivityIndicator.IsVisible>
            </ActivityIndicator>
        </VerticalStackLayout>

        <Grid Grid.Row="3">
            <Grid.RowDefinitions>
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <ScrollView Orientation="Vertical" Grid.Row="0">
                <VerticalStackLayout>
                    <!--Owned Placelists-->
                    <CollectionView ItemsSource="{Binding OwnedPlacelists}" IsVisible="{Binding IsPlacelistsOwnedTabSelected}">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <components:PlacelistHeader BindingContext="{Binding}" />
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>

                    <!--Followed Placelists-->
                    <CollectionView ItemsSource="{Binding FollowedPlacelists}" IsVisible="{Binding IsPlacelistsFollowedTabSelected}">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <components:PlacelistHeader BindingContext="{Binding}" />
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </ScrollView>
        </Grid>

    </Grid>
    
</ContentPage>